define(["jquery"],function(a){return{init:function(){function b(d,e){var f=d.attr("data-url")+"&videoFormat="+c;if("undefined"==typeof e)var e=d.parent();a.get(f,function(a){e.html("").append(a).css({height:"auto",width:"auto"}),a.toLowerCase().indexOf('data-view="lock"')>=0&&setTimeout(function(){b(d,e)},1111)}),d.removeAttr("data-type")}!function(){function b(a,b){var c=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,d=document.documentElement.clientHeight,e=c+d;b=b||0;var f=a.getBoundingClientRect();if(0===f.height)return!1;var g=f.top+c-b,h=f.bottom+c+b;return h>c&&e>g}a.expr[":"]["near-viewport"]=function(a,c,d){var e=parseInt(d[3])||0;return b(a,e)}}(),a.ajaxSetup({cache:!1});var c="webm",d=document.createElement("video");d.canPlayType&&d.canPlayType("video/mp4").replace(/no/,"")&&(c="mp4"),a("div[data-type='esObject']:near-viewport(400)").each(function(){b(a(this))}),a(window).scroll(function(){a("div[data-type='esObject']:near-viewport(400)").each(function(){b(a(this))})}),a("body").click(function(b){a(b.target).closest(".edusharing_metadata").length||(a(b.target).closest(".edusharing_metadata_toggle_button").length?(a(".edusharing_metadata").hide(),toggle_button=a(b.target),metadata=toggle_button.parent().find(".edusharing_metadata"),metadata.hasClass("open")?(metadata.toggleClass("open"),metadata.hide()):(a(".edusharing_metadata").removeClass("open"),metadata.toggleClass("open"),metadata.show())):(a(".edusharing_metadata").hide(),a(".edusharing_metadata").removeClass("open")))})}}});